(()=>{var e={};e.id=8498,e.ids=[8498],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},83122:e=>{"use strict";e.exports=require("undici")},6113:e=>{"use strict";e.exports=require("crypto")},9523:e=>{"use strict";e.exports=require("dns")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},13685:e=>{"use strict";e.exports=require("http")},85158:e=>{"use strict";e.exports=require("http2")},41808:e=>{"use strict";e.exports=require("net")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},77282:e=>{"use strict";e.exports=require("process")},12781:e=>{"use strict";e.exports=require("stream")},24404:e=>{"use strict";e.exports=require("tls")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},69819:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>a.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>c,routeModule:()=>h,tree:()=>d}),s(11065),s(13321),s(85070),s(35866);var r=s(23191),n=s(88716),i=s(37922),a=s.n(i),l=s(95231),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);s.d(t,o);let d=["",{children:["dashboard",{children:["counselling",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,11065)),"C:\\Users\\Admin\\Desktop\\app\\app\\dashboard\\counselling\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,13321)),"C:\\Users\\Admin\\Desktop\\app\\app\\dashboard\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,85070)),"C:\\Users\\Admin\\Desktop\\app\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,35866,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\Users\\Admin\\Desktop\\app\\app\\dashboard\\counselling\\page.tsx"],u="/dashboard/counselling/page",p={require:s,loadChunk:()=>Promise.resolve()},h=new r.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/dashboard/counselling/page",pathname:"/dashboard/counselling",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},3148:(e,t,s)=>{Promise.resolve().then(s.bind(s,81804))},81804:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>T});var r=s(10326),n=s(17577),i=s(29752),a=s(91664),l=s(41190),o=s(44794),d=s(82015),c=s(29280),u=s(41156),p=s(13961),h=s(64004),x=s(5932),m=s(31215),g=s(77506),j=s(82685),v=s(98091),y=s(84097),b=s(74723),N=s(74064),f=s(770);let w=["Academic","Behavioral","Family Issues","Peer Relationship","Personal","Crisis Intervention","Other"],C=f.Ry({id:f.Z_(),schoolId:f.Z_(),userId:f.Z_(),sessionDate:f.Z_().min(1,"Session date is required."),studentName:f.Z_().min(1,"Student name is required."),studentId:f.Z_().min(1,"Student ID is required."),studentDob:f.Z_().min(1,"Student Date of Birth is required."),studentYear:f.Z_().min(1,"Student year level is required."),counsellingType:f.Km(w,{required_error:"Counselling type is required."}),otherCounsellingType:f.Z_().optional(),sessionDetails:f.Z_().min(1,"Session details are required."),actionPlan:f.Z_().min(1,"Action plan or next steps are required."),parentsContacted:f.Km(["Yes","No","Attempted","Not Required"]).optional(),counsellorName:f.Z_().min(1,"Counsellor's name is required."),createdAt:f.Z_().datetime().or(f.hT()),updatedAt:f.Z_().datetime().or(f.hT())}).omit({id:!0,schoolId:!0,userId:!0,createdAt:!0,updatedAt:!0}).refine(e=>"Other"!==e.counsellingType||!!e.otherCounsellingType,{message:"Please specify the 'Other' counselling type.",path:["otherCounsellingType"]});var D=s(24118),S=s(38227),A=s(12727),q=s(76025),I=s(76),P=s(76074);async function _(e){if(!q.db)throw Error("Firestore is not configured.");let t=(0,I.hJ)(q.db,"counselling"),s=(0,I.IO)(t,(0,I.ar)("schoolId","==",e));return(await (0,I.PL)(s)).docs.map(e=>{let t=e.data();return{...t,id:e.id,sessionDate:t.sessionDate,studentDob:t.studentDob,createdAt:t.createdAt instanceof I.EK?t.createdAt.toDate().toISOString():t.createdAt,updatedAt:t.updatedAt instanceof I.EK?t.updatedAt.toDate().toISOString():t.updatedAt}})}async function F(e,t){if(!q.db)throw Error("Firestore is not configured.");if(t){let s=(0,I.JU)(q.db,"counselling",t),r={...e,updatedAt:(0,I.Bt)()};return await (0,I.r7)(s,r),{...e,id:t,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}{let t=(0,I.hJ)(q.db,"counselling"),s={...e,createdAt:(0,I.Bt)(),updatedAt:(0,I.Bt)()},r=await (0,I.ET)(t,s);return{...e,id:r.id,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}}async function Z(e){if(!q.db)throw Error("Firestore is not configured.");let t=(0,I.JU)(q.db,"counselling",e);await (0,I.oe)(t)}function T(){let{toast:e}=(0,y.pm)(),[t,s]=(0,n.useState)([]),[f,I]=(0,n.useState)(!0),[T,R]=(0,n.useState)(null),[k,E]=(0,n.useState)(null),[O,B]=(0,n.useState)(!1),[Y,L]=(0,n.useState)(null),[U,M]=(0,n.useState)(null),[Q,G]=(0,n.useState)(""),V=(0,n.useCallback)(async()=>{if(!Y){q.W&&R("Your school ID is not set. Cannot load data."),I(!1);return}I(!0),R(null);try{let e=await _(Y);s(e)}catch(e){R(e instanceof Error?e.message:"An unknown error occurred."),s([])}finally{I(!1)}},[Y]),{register:$,handleSubmit:K,reset:J,control:W,watch:z,getValues:H,formState:{errors:X,isSubmitting:ee}}=(0,b.cI)({resolver:(0,N.F)(C),defaultValues:{sessionDate:"",studentName:"",studentId:"",studentDob:"",studentYear:"",counsellingType:void 0,otherCounsellingType:"",sessionDetails:"",actionPlan:"",parentsContacted:void 0,counsellorName:""}}),et=z("counsellingType"),es=async t=>{if(!q.W){e({variant:"destructive",title:"Action Disabled",description:"Cannot save record because Firebase is not configured."});return}if(!Y||!U){e({variant:"destructive",title:"Save Failed",description:"School ID or User ID not found. Cannot save record."});return}let s={...t,schoolId:Y,userId:U};try{await F(s,k??void 0),await V(),e({title:k?"Record Updated":"Record Saved",description:`Counselling record for ${t.studentName} has been processed.`}),B(!1),J()}catch(t){console.error("Error saving record to Firestore:",t),e({variant:"destructive",title:"Save Failed",description:"Could not save counselling record."})}},er=e=>{E(e),B(!0)},en=async t=>{if(window.confirm("Are you sure you want to delete this counselling record?")){if(!q.W){e({variant:"destructive",title:"Action Disabled",description:"Cannot delete record because Firebase is not configured."});return}try{await Z(t),await V(),e({title:"Record Deleted",description:"The counselling record has been deleted."})}catch(t){console.error("Error deleting record from Firestore:",t),e({variant:"destructive",title:"Delete Failed",description:"Could not delete record."})}}},ei=()=>{e({title:"Printing...",description:"Use your browser's print dialog to save as PDF or print."}),window.print()};return(0,r.jsxs)("div",{className:"p-8 space-y-8",children:[r.jsx(A.m,{title:"Counselling Records",description:"Manage confidential student counselling records.",children:(0,r.jsxs)(a.Button,{onClick:()=>{E(null),G(`NEW-${Date.now()}`),J(),B(!0)},children:[r.jsx(p.Z,{className:"mr-2 h-5 w-5"})," Add New Record"]})}),r.jsx(D.Vq,{open:O,onOpenChange:e=>{B(e),e||(E(null),J(),G(""))},children:(0,r.jsxs)(D.cZ,{className:"sm:max-w-lg md:max-w-xl lg:max-w-2xl",children:[r.jsx(D.fK,{children:r.jsx(D.$N,{className:"font-headline",children:k?"Edit Counselling Record":"New Record Entry"})}),r.jsx("div",{className:"printable-area",children:(0,r.jsxs)("form",{id:"counselling-form",onSubmit:K(es),className:"space-y-3 font-body max-h-[70vh] overflow-y-auto p-1 pr-3",children:[(0,r.jsxs)("div",{children:[r.jsx(o.Label,{htmlFor:"record-id",children:"Record ID"}),r.jsx(l.I,{id:"record-id",value:Q,readOnly:!0,disabled:!0,className:"bg-muted/50 cursor-not-allowed"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[r.jsx(o.Label,{htmlFor:"session-date",children:"Date of Session"}),r.jsx(l.I,{type:"date",id:"session-date",...$("sessionDate")}),X.sessionDate&&r.jsx("p",{className:"text-destructive text-xs mt-1",children:X.sessionDate.message})]}),(0,r.jsxs)("div",{children:[r.jsx(o.Label,{htmlFor:"counsellor-name",children:"Counsellor Name"}),r.jsx(l.I,{type:"text",id:"counsellor-name",...$("counsellorName"),placeholder:"Full Name"}),X.counsellorName&&r.jsx("p",{className:"text-destructive text-xs mt-1",children:X.counsellorName.message})]}),(0,r.jsxs)("div",{children:[r.jsx(o.Label,{htmlFor:"student-name",children:"Student Name"}),r.jsx(l.I,{type:"text",id:"student-name",...$("studentName"),placeholder:"Full Name"}),X.studentName&&r.jsx("p",{className:"text-destructive text-xs mt-1",children:X.studentName.message})]}),(0,r.jsxs)("div",{children:[r.jsx(o.Label,{htmlFor:"student-id",children:"Student ID"}),r.jsx(l.I,{type:"text",id:"student-id",...$("studentId"),placeholder:"e.g., S12345"}),X.studentId&&r.jsx("p",{className:"text-destructive text-xs mt-1",children:X.studentId.message})]}),(0,r.jsxs)("div",{children:[r.jsx(o.Label,{htmlFor:"student-dob",children:"Date of Birth"}),r.jsx(l.I,{type:"date",id:"student-dob",...$("studentDob")}),X.studentDob&&r.jsx("p",{className:"text-destructive text-xs mt-1",children:X.studentDob.message})]}),(0,r.jsxs)("div",{children:[r.jsx(o.Label,{htmlFor:"student-year",children:"Year Level"}),r.jsx(b.Qr,{name:"studentYear",control:W,render:({field:e})=>r.jsx(P.d,{id:"student-year-select",value:e.value,onValueChange:e.onChange})}),X.studentYear&&r.jsx("p",{className:"text-destructive text-xs mt-1",children:X.studentYear.message})]})]}),(0,r.jsxs)("div",{children:[r.jsx(o.Label,{htmlFor:"counselling-type",children:"Type of Counselling"}),r.jsx(b.Qr,{name:"counsellingType",control:W,render:({field:e})=>(0,r.jsxs)(c.Ph,{onValueChange:e.onChange,value:e.value,children:[r.jsx(c.i4,{id:"counselling-type",children:r.jsx(c.ki,{placeholder:"Select type"})}),r.jsx(c.Bw,{children:w.map(e=>r.jsx(c.Ql,{value:e,children:e},e))})]})}),X.counsellingType&&r.jsx("p",{className:"text-destructive text-xs mt-1",children:X.counsellingType.message})]}),"Other"===et&&(0,r.jsxs)("div",{children:[r.jsx(o.Label,{htmlFor:"other-counselling-type",children:"Other Counselling Type"}),r.jsx(l.I,{type:"text",id:"other-counselling-type",...$("otherCounsellingType"),placeholder:"Describe other type"}),X.otherCounsellingType&&r.jsx("p",{className:"text-destructive text-xs mt-1",children:X.otherCounsellingType.message})]}),(0,r.jsxs)("div",{children:[r.jsx(o.Label,{htmlFor:"session-details",children:"Session Details"}),r.jsx(d.g,{id:"session-details",...$("sessionDetails"),placeholder:"Detailed description of the session...",rows:3}),X.sessionDetails&&r.jsx("p",{className:"text-destructive text-xs mt-1",children:X.sessionDetails.message})]}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:(0,r.jsxs)("div",{children:[r.jsx(o.Label,{htmlFor:"parents-contacted",children:"Parents Contacted"}),r.jsx(b.Qr,{name:"parentsContacted",control:W,render:({field:e})=>(0,r.jsxs)(c.Ph,{onValueChange:e.onChange,value:e.value,children:[r.jsx(c.i4,{id:"parents-contacted",children:r.jsx(c.ki,{placeholder:"Select status"})}),(0,r.jsxs)(c.Bw,{children:[r.jsx(c.Ql,{value:"Yes",children:"Yes"}),r.jsx(c.Ql,{value:"No",children:"No"}),r.jsx(c.Ql,{value:"Attempted",children:"Attempted, No Response"}),r.jsx(c.Ql,{value:"Not Required",children:"Not Required"})]})]})}),X.parentsContacted&&r.jsx("p",{className:"text-destructive text-xs mt-1",children:X.parentsContacted.message})]})}),(0,r.jsxs)("div",{children:[r.jsx(o.Label,{htmlFor:"action-plan",children:"Action Plan / Follow-up"}),r.jsx(d.g,{id:"action-plan",...$("actionPlan"),placeholder:"Describe action plan and next steps...",rows:3}),X.actionPlan&&r.jsx("p",{className:"text-destructive text-xs mt-1",children:X.actionPlan.message})]})]})}),(0,r.jsxs)(D.cN,{className:"pt-3 print:hidden flex-wrap justify-center sm:justify-end gap-2",children:[(0,r.jsxs)(a.Button,{type:"button",variant:"outline",onClick:ei,children:[r.jsx(h.Z,{className:"mr-2 h-4 w-4"})," Print Form"]}),(0,r.jsxs)(a.Button,{type:"button",variant:"outline",onClick:()=>{e({title:"Emailing Record (Simulated)",description:"An email would be sent to the relevant parties."})},children:[r.jsx(x.Z,{className:"mr-2 h-4 w-4"})," Email Form"]}),(0,r.jsxs)(a.Button,{type:"button",variant:"secondary",onClick:()=>{console.log("Saving draft (simulated):",{id:Q,...H()}),e({title:"Draft Saved",description:"Your counselling record draft has been saved (simulated)."})},disabled:ee,children:[r.jsx(m.Z,{className:"mr-2 h-4 w-4"})," Save Draft"]}),r.jsx(D.GG,{asChild:!0,children:r.jsx(a.Button,{type:"button",variant:"outline",children:"Cancel"})}),(0,r.jsxs)(a.Button,{type:"submit",form:"counselling-form",disabled:ee,children:[ee?r.jsx(g.Z,{className:"mr-2 h-4 w-4 animate-spin"}):r.jsx(m.Z,{className:"mr-2 h-4 w-4"}),k?"Update Record":"Save Record"]})]})]})}),(0,r.jsxs)("div",{className:"printable-area",children:[!f&&!T&&t.length>0&&(0,r.jsxs)(i.Zb,{id:"preview-section",className:"p-4 mt-8",children:[r.jsx(i.Ol,{children:r.jsx(i.ll,{className:"text-2xl font-headline",children:`All Counselling Records (${t.length})`})}),(0,r.jsxs)(i.aY,{children:[r.jsx("div",{className:"overflow-x-auto",children:(0,r.jsxs)(u.iA,{children:[r.jsx(u.xD,{children:(0,r.jsxs)(u.SC,{children:[r.jsx(u.ss,{children:"Date"}),r.jsx(u.ss,{children:"Name"}),r.jsx(u.ss,{children:"ID"}),r.jsx(u.ss,{children:"Year"}),r.jsx(u.ss,{children:"Type"}),r.jsx(u.ss,{className:"print:hidden",children:"Actions"})]})}),r.jsx(u.RM,{children:t.map(e=>(0,r.jsxs)(u.SC,{children:[r.jsx(u.pj,{children:e.sessionDate}),r.jsx(u.pj,{children:e.studentName}),r.jsx(u.pj,{children:e.studentId}),r.jsx(u.pj,{children:e.studentYear}),r.jsx(u.pj,{children:"Other"===e.counsellingType?e.otherCounsellingType:e.counsellingType}),(0,r.jsxs)(u.pj,{className:"space-x-1 print:hidden",children:[r.jsx(a.Button,{variant:"ghost",size:"icon",onClick:()=>e.id&&er(e.id),title:"Edit Record",children:r.jsx(j.Z,{className:"h-4 w-4"})}),r.jsx(a.Button,{variant:"ghost",size:"icon",onClick:()=>e.id&&en(e.id),title:"Delete Record",children:r.jsx(v.Z,{className:"h-4 w-4 text-destructive"})})]})]},e.id))})]})}),(0,r.jsxs)(a.Button,{onClick:ei,className:"w-full sm:w-auto mt-6 print:hidden",children:[r.jsx(h.Z,{className:"mr-2 h-5 w-5"})," Print Records"]})]})]}),!f&&!T&&0===t.length&&(0,r.jsxs)(i.Zb,{className:"mt-6 bg-muted/30 print:hidden",children:[r.jsx(i.Ol,{children:r.jsx(i.ll,{className:"text-base flex items-center",children:"No Counselling Records"})}),r.jsx(i.aY,{children:r.jsx("p",{className:"text-sm text-foreground",children:"No counselling records found for this school. Add a new record to get started."})})]}),T&&r.jsx(i.Zb,{className:"mt-6 bg-destructive/10 text-destructive p-4",children:T}),f&&r.jsx("div",{className:"space-y-2",children:r.jsx(S.O,{className:"h-40 w-full"})})]})]})}},64004:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.395.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(62881).Z)("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]])},11065:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>a,__esModule:()=>i,default:()=>l});var r=s(68570);let n=(0,r.createProxy)(String.raw`C:\Users\Admin\Desktop\app\app\dashboard\counselling\page.tsx`),{__esModule:i,$$typeof:a}=n;n.default;let l=(0,r.createProxy)(String.raw`C:\Users\Admin\Desktop\app\app\dashboard\counselling\page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[8537,434,3121,9082,5426,9131,770,4064,8578,4476],()=>s(69819));module.exports=r})();