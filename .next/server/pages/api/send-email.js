"use strict";(()=>{var e={};e.id=4957,e.ids=[4957],e.modules={60325:e=>{e.exports=require("firebase-admin/app")},12594:e=>{e.exports=require("firebase-admin/firestore")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},56249:(e,r)=>{Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},36909:(e,r,t)=>{t.r(r),t.d(r,{config:()=>g,default:()=>m,routeModule:()=>h});var o={};t.r(o),t.d(o,{default:()=>f});var s=t(71802),n=t(47153),a=t(56249);let i=require("nodemailer");var l=t.n(i),u=t(60325),c=t(12594);if(function(){var e=Error("Cannot find module '@root/serviceAccountKey.json'");throw e.code="MODULE_NOT_FOUND",e}(),!(0,u.getApps)().length)try{(0,u.initializeApp)({credential:(0,u.cert)(Object(function(){var e=Error("Cannot find module '@root/serviceAccountKey.json'");throw e.code="MODULE_NOT_FOUND",e}()))})}catch(e){console.error("Firebase Admin Initialization Error",e)}let d=(0,u.getApps)().length>0?(0,c.getFirestore)():null;async function p(e){if(!d)return null;let r=d.collection("schoolSettings").doc(e),t=await r.get();return t.exists?t.data():null}async function f(e,r){let t,o;if("POST"!==e.method)return r.status(405).json({error:"Method Not Allowed"});let{to:s,subject:n,body:a,schoolId:i}=e.body;if(!s||!n||!a)return r.status(400).json({error:"Missing required fields: to, subject, body"});if(i&&d){let e=await p(i);e?(t={host:e.host,port:e.port,secure:e.secure,auth:{user:e.user,pass:e.pass}},o=`"${i}" <${e.user}>`):(t={host:"smtp.gmail.com",port:587,secure:!1,auth:{user:"cloudharekrishna@gmail.com",pass:"pwkedgvrqiztvwfc"}},o=`"School Platform" <${t.auth.user}>`)}else t={host:"smtp.gmail.com",port:587,secure:!1,auth:{user:"cloudharekrishna@gmail.com",pass:"pwkedgvrqiztvwfc"}},o=`"School Platform" <${t.auth.user}>`;let u=async(e,r,t)=>{d&&await d.collection("emailHistory").add({recipient:s,subject:n,status:e,error:r||null,messageId:t||null,sentAt:c.FieldValue.serverTimestamp()})};if(!t?.auth?.user||!t?.auth?.pass){let e="SMTP configuration is incomplete.";return console.error(e),await u("Failed","Configuration Error"),r.status(500).json({error:e})}let f=l().createTransport(t);try{await f.verify();let e=await f.sendMail({from:o,to:s,subject:n,text:a,html:`<p>${a.replace(/\n/g,"<br>")}</p>`});console.log("Message sent: %s",e.messageId),await u("Success",void 0,e.messageId),r.status(200).json({success:!0,message:`Email successfully sent to ${s}.`})}catch(t){console.error("Error sending email:",t);let e=t instanceof Error?t.message:"An unknown error occurred.";await u("Failed",e),r.status(500).json({error:`Failed to send email: ${e}`})}}let m=(0,a.l)(o,"default"),g=(0,a.l)(o,"config"),h=new s.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/send-email",pathname:"/api/send-email",bundlePath:"",filename:""},userland:o})},47153:(e,r)=>{var t;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(t||(t={}))},71802:(e,r,t)=>{e.exports=t(20145)}};var r=require("../../webpack-api-runtime.js");r.C(e);var t=r(r.s=36909);module.exports=t})();